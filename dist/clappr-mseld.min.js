!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],t):e.MSELD=t(e.Clappr)}(this,function(s){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}var i="URLSearchParams"in self,c="Symbol"in self&&"iterator"in Symbol,h="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),f="FormData"in self,l="ArrayBuffer"in self;if(l)var t=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(e){return e&&-1<t.indexOf(Object.prototype.toString.call(e))};function p(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function y(e){return"string"!=typeof e&&(e=String(e)),e}function m(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return c&&(e[Symbol.iterator]=function(){return e}),e}function v(t){this.map={},t instanceof v?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function b(r){return new Promise(function(e,t){r.onload=function(){e(r.result)},r.onerror=function(){t(r.error)}})}function E(e){var t=new FileReader,r=b(t);return t.readAsArrayBuffer(e),r}function _(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function S(){return this.bodyUsed=!1,this._initBody=function(e){var t;(this._bodyInit=e)?"string"==typeof e?this._bodyText=e:h&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:f&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():l&&h&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=_(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):l&&(ArrayBuffer.prototype.isPrototypeOf(e)||d(e))?this._bodyArrayBuffer=_(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},h&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(E)}),this.text=function(){var e,t,r,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=b(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},f&&(this.formData=function(){return this.text().then(O)}),this.json=function(){return this.text().then(JSON.parse)},this}v.prototype.append=function(e,t){e=p(e),t=y(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},v.prototype.delete=function(e){delete this.map[p(e)]},v.prototype.get=function(e){return e=p(e),this.has(e)?this.map[e]:null},v.prototype.has=function(e){return this.map.hasOwnProperty(p(e))},v.prototype.set=function(e,t){this.map[p(e)]=y(t)},v.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},v.prototype.keys=function(){var r=[];return this.forEach(function(e,t){r.push(t)}),m(r)},v.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),m(t)},v.prototype.entries=function(){var r=[];return this.forEach(function(e,t){r.push([t,e])}),m(r)},c&&(v.prototype[Symbol.iterator]=v.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function T(e,t){var r,n,o=(t=t||{}).body;if(e instanceof T){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new v(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new v(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),-1<w.indexOf(n)?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function O(e){var o=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),r=t.shift().replace(/\+/g," "),n=t.join("=").replace(/\+/g," ");o.append(decodeURIComponent(r),decodeURIComponent(n))}}),o}function M(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new v(t.headers),this.url=t.url||"",this._initBody(e)}T.prototype.clone=function(){return new T(this,{body:this._bodyInit})},S.call(T.prototype),S.call(M.prototype),M.prototype.clone=function(){return new M(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},M.error=function(){var e=new M(null,{status:0,statusText:""});return e.type="error",e};var k=[301,302,303,307,308];M.redirect=function(e,t){if(-1===k.indexOf(t))throw new RangeError("Invalid status code");return new M(null,{status:t,headers:{location:e}})};var A=self.DOMException;try{new A}catch(e){(A=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),A.prototype.constructor=A}function P(o,s){return new Promise(function(n,e){var t=new T(o,s);if(t.signal&&t.signal.aborted)return e(new A("Aborted","AbortError"));var i=new XMLHttpRequest;function r(){i.abort()}i.onload=function(){var e,o,t={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",o=new v,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),r=t.shift().trim();if(r){var n=t.join(":").trim();o.append(r,n)}}),o)};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var r="response"in i?i.response:i.responseText;n(new M(r,t))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.onabort=function(){e(new A("Aborted","AbortError"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&h&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),t.signal&&(t.signal.addEventListener("abort",r),i.onreadystatechange=function(){4===i.readyState&&t.signal.removeEventListener("abort",r)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})}P.polyfill=!0,self.fetch||(self.fetch=P,self.Headers=v,self.Request=T,self.Response=M);var I,j,B=(function(e,t){function o(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var r,n;window,e.exports=(n={},o.m=r=[function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=r(50);function a(){}var i={trace:a,debug:a,log:a,warn:a,info:a,error:a},u=i,c=(0,o.getSelfScope)();t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":n(e))){!function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];r.forEach(function(e){var i,s;u[e]=t[e]?t[e].bind(t):(i=e,(s=c.console[i])?function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,o;t[0]&&(t[0]=(n=i,o=t[0],"["+n+"] > "+o)),s.apply(c.console,t)}:a)})}(e,"trace","debug","log","info","warn","error");try{u.log()}catch(e){u=i}}else u=i},t.logger=u},function(e,t){var r=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(20),o=r(25);e.exports=r(5)?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=!r(7)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var i=r(28);e.exports=function(n,o,e){if(i(n),void 0===o)return n;switch(e){case 1:return function(e){return n.call(o,e)};case 2:return function(e,t){return n.call(o,e,t)};case 3:return function(e,t,r){return n.call(o,e,t,r)}}return function(){return n.apply(o,arguments)}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(38)("wks"),o=r(8),i=r(0).Symbol,s="function"==typeof i;(e.exports=function(e){return n[e]||(n[e]=s&&i[e]||(s?i:o)("Symbol."+e))}).store=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=t.MAX_DELAY=void 0,t.getMediaSource=o,t.isAndroid=i,t.isSupportedMSE=function(){if(i())return!1;var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!n},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=function(e){return new Uint8Array(e)},t.getTrackId=n,t.getRealUtcFromData=s,t.doArrayBuffer=function(e){e.isInit||(this.utc=s(e.data),this.lastLoadedUTC=this.utc)},t.debugData=function(e){var t=new Uint8Array(e);return{trackId:n(t),utc:s(t),view:t}},t.pad2=c,t.humanTime=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!(0<e))return"";var r=e,n=new Date;n.setTime(1e3*r);var o=!(!1===t),i=o?n.getHours():n.getUTCHours(),s=o?n.getMinutes():n.getUTCMinutes(),a=o?n.getSeconds():n.getUTCSeconds();return c(i)+":"+c(s)+":"+c(a)},t.logDM=function(e,t){t&&m.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e,t){e.data,ArrayBuffer;this.media&&this.media.error,++h>=this.opts.errorsBeforeStop&&(h=0,this.stopPromise=this.stop()),this.onError&&this.onError(t,e)};var m=r(2);function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function i(){return-1!==navigator.userAgent.indexOf("Android")}function n(e){return e[47]}function s(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}var a=navigator.userAgent,u=t.MAX_DELAY=/Edge/.test(a)||/trident.*rv:1\d/i.test(a)?10:2;t.checkVideoProgress=function(d,p,e){var y=2<arguments.length&&void 0!==e?e:u;return function(e){function t(e,t,r,n){try{for(var o=0;o<t.buffered.length;o++){var i=t.buffered.start(o),s=t.buffered.end(o),a=Math.max(i,r),u=Math.min(s,n);if(.5<Math.min(u,s)-a)return d&&d.currentTime.toString(),t.remove(a,u),1}}catch(e){}}var r=d.currentTime,n=d.buffered,o=d.buffered.length;if(p)for(var i=p.sb.sourceBuffer,s=Object.keys(i),a=r-30,u=s.length-1;0<=u;u--){var c=i[s[u]];if(c){var h=c.buffered;0<h.length&&a>h.start(0)&&t(0,c,0,a)}}if(o){var f=n.end(o-1),l=Math.abs(f-r);p._stalling&&(p.onEndStalling(),d.paused&&p._pause&&!p.playing&&(d.currentTime=f-1e-4,p.playPromise=d.play(),p.playPromise.then(function(){p._pause=!1,p.playing=!0}).catch(function(){}))),l<=y||(m.logger.log("nudge",r,"->",o?f:"-",r-f),d.currentTime=f-.2)}}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")},t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack};function c(e){return e<=9?"0"+e:""+e}var h=0},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO="video",t.AUDIO="audio"},function(e,t,r){e.exports=r(15)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(16),i=(n=o)&&n.__esModule?n:{default:n};t.default=i.default,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(17);var o=d(r(40)),s=d(r(51)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(12)),u=r(2),c=r(52),h=r(13),f=d(r(6)),l=d(r(53));function d(e){return e&&e.__esModule?e:{default:e}}var p=h.VIDEO,y=h.AUDIO,m=(v.replaceHttpByWS=function(e){return a.replaceHttpByWS(e)},v.isSupported=function(){return a.isSupportedMSE()},function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(v,null,[{key:"version",get:function(){return"20.2.3"}}]),v.prototype.play=function(e,t,r){var n=this;return u.logger.log("[mse-player]: play()"),this._play(e,t,r).then(function(){n.playing=!0}).catch(function(){n.playing=!1})},v.prototype.stop=function(){return this.onMediaDetaching()},v.prototype.seek=function(e){if(this.playing)try{if(!e)throw new Error('utc should be "live" or UTC value');this.ws.seek(e),this.sb.seek(),this.onStartStalling(),this.seekValue=e,this.media.pause(),this._pause=!0,this.playing=!1}catch(e){u.logger.warn("seek:"+e.message)}},v.prototype.pause=function(){if(!function(){return!(!(!this._pause&&this.playing&&this.media&&this.ws&&this.mediaSource)||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)}.bind(this)())return u.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.onPause)try{this.onPause()}catch(e){}}.bind(this);this.playPromise.then(e,e)},v.prototype.restart=function(e){var t=0<arguments.length&&void 0!==e&&e?void 0:this.sb.lastLoadedUTC;this.playing=!1,this.ws.destroy(),this.ws.init(),this.ws.start(this.url,t,this.videoTrack,this.audioTrack)},v.prototype.retryConnection=function(e,t,r){var n=0<arguments.length&&void 0!==e?e:null,o=1<arguments.length&&void 0!==t?t:null,i=2<arguments.length&&void 0!==r?r:null;this.retry>=this.opts.connectionRetries?clearInterval(this.retryConnectionTimer):(u.logger.log("%cconnectionRetry:","background: orange;","Retrying "+(this.retry+1)),this.mediaSource=void 0,this.init(),this.ws.destroy(),this.sb.destroy(),this.play(n,o,i),this.retry=this.retry+1)},v.prototype.setTracks=function(e){var r=this;if(this.mediaInfo){var n=this.mediaInfo.streams?"streams":"tracks",t=e.filter(function(t){var e=r.mediaInfo[n].find(function(e){return t===e.track_id});return!!e&&e.content===p}).join(""),o=e.filter(function(t){var e=r.mediaInfo[n].find(function(e){return t===e.track_id});return e&&e.bitrate&&0!==e.bitrate?!!e&&e.content===y:null}).join("");this.onStartStalling(),this.ws.setTracks(t,o),this.videoTrack=t,this.audioTrack=o,this._setTracksFlag=!0,this.waitForInitFrame=!0}else u.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},v.prototype._play=function(n,o,i){var s=this;return this.liveError=!1,new Promise(function(e,t){if(u.logger.log("_play",n,o,i),s.playing){var r="[mse-player] _play: terminate because already has been playing";return u.logger.log(r),e({message:r})}return s._pause?s.ws&&!1===s.ws.opened?(u.logger.log("WebSocket Closed, trying to restart it"),s._pause=!1,void s.restart(!0)):(u.logger.log("WebSocket is in opened state, resuming"),s._pause=!1,s._resume(),s.playPromise=s.media.play(),u.logger.log("_play: terminate because _paused and should resume"),s.playPromise):(s.playTime=n,s.videoTrack=o,s.audioTrack=i,s._pause=!1,s.mediaSource||s.onAttachMedia({media:s.media}).then(function(){s.onsoa=s._play.bind(s,n,o,i),s.mediaSource.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,s.onsoa),u.logger.warn("mediaSource did not create"),s.resolveThenMediaSourceOpen=s.resolveThenMediaSourceOpen?s.resolveThenMediaSourceOpen:e,s.rejectThenMediaSourceOpen=s.rejectThenMediaSourceOpen?s.rejectThenMediaSourceOpen:t}),s.mediaSource&&"open"!==s.mediaSource.readyState?(u.logger.warn('readyState is not "open", it\'s currently ',s.mediaSource.readyState),s.shouldPlay=!0,s.resolveThenMediaSourceOpen=s.resolveThenMediaSourceOpen?s.resolveThenMediaSourceOpen:e,void(s.rejectThenMediaSourceOpen=s.rejectThenMediaSourceOpen?s.rejectThenMediaSourceOpen:t)):void new Promise(function(e,t){return!s.media.autoplay||!0===s.media.muted||s.opts.retryMuted?e():s.onAutoplay?void s.onAutoplay(function(){return s.media.muted=!1,e()}):(s.media.muted=!0,e())}).then(function(){s.ws.start(s.url,s.playTime,s.videoTrack,s.audioTrack).then(function(){return s.playPromise=s.media.play(),s.startProgressTimer(),s.playPromise.then(function(){s.onStartStalling(),s.resolveThenMediaSourceOpen&&(s._stop=!1,s.resolveThenMediaSourceOpen(),s.resolveThenMediaSourceOpen=void 0,s.rejectThenMediaSourceOpen=void 0,clearInterval(s.retryConnectionTimer),s.retry=0)}).catch(function(e){u.logger.log("playPromise rejection.",e),s.ws.connectionPromise&&s.ws.connectionPromise.then(function(){return s.ws.pause()}),s.opts.retryMuted&&0==s.media.muted&&(s.onMuted&&s.onMuted(),s.media.muted=!0,s._play(n,o,i)),s.onError&&s.onError({error:"play_promise_reject",err:e}),s.rejectThenMediaSourceOpen&&(s.rejectThenMediaSourceOpen(),s.resolveThenMediaSourceOpen=void 0,s.rejectThenMediaSourceOpen=void 0),s.opts.retryMuted||s.stop()}),s.playPromise})}))})},v.prototype.init=function(){this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.playTime=void 0,this.audioTrack="",this.videoTrack="",this.endProgressTimer()},v.prototype._resume=function(){this.ws.resume()},v.prototype.onMediaDetaching=function(){var e=this;if(!this.stopRunning)return this.stopRunning=!0,this.handlerMediaDetaching.bind(this),this.playPromise&&this.playPromise.then(function(){return e.handlerMediaDetaching()}).catch(function(){return e.handlerMediaDetaching()}),this.playPromise,this.handlerMediaDetaching();u.logger.warn("stop is running.")},v.prototype.handlerMediaDetaching=function(){var t=this;u.logger.info("media source detaching");var e=void 0;return this.removeMediaSource(),this._stop=!0,this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),(e=new Promise(function(e){t._onmee=t.onMediaElementEmptied(e).bind(t)})).then(function(){return t.stopRunning=!1}),this.media.addEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this._onmee)),this.oncvp=null,this.mediaSource=null,this.init(),this.ws.destroy(),this.sb.destroy(),e},v.prototype.removeMediaSource=function(){var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){u.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}this.media.removeAttribute("src"),this.media.load()},v.prototype.onMediaElementEmptied=function(e){return this._onmee&&this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this._onmee),this._onmee=void 0),e()},v.prototype.onAttachMedia=function(e){var t=this;this.media=e.media;var r=this.media;if(!(r instanceof HTMLMediaElement))throw new Error(l.default.NOT_HTML_MEDIA_ELEMENT);if(r){var n=this.mediaSource=new MediaSource;return this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),r.src=URL.createObjectURL(n),this.oncvp=a.checkVideoProgress(r,this).bind(this),this.media.addEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.liveError?void(this.player=void 0):new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)})}},v.prototype.onMediaSourceOpen=function(e){e();var t=this.mediaSource;t&&t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),URL.revokeObjectURL(this.media.src),this.shouldPlay&&(this.shouldPlay=!1,u.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.playTime,this.audioTrack,this.videoTrack),this._play(this.playTime,this.audioTrack,this.videoTrack))},v.prototype.onDisconnect=function(e){this.opts.onDisconnect&&this.opts.onDisconnect(e)},v.prototype.dispatchMessage=function(e){var t=this;if(!this.stopRunning){var r=e.data,n=r instanceof ArrayBuffer,o=n?void 0:JSON.parse(r);try{if(n){if(this.waitForInitFrame)return u.logger.log("old frames");this.sb.procArrayBuffer(r)}if(o&&o.type===c.EVENT_SEGMENT){var i=o[c.EVENT_SEGMENT];switch(u.logger.log("%c "+o.type+" "+("event"===o.type?o.event:"mse_init_segment"),"background: aquamarine;",o),i){case"resumed":this._pause&&!this.playing&&this.onStartStalling();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(t){}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":u.logger.log("do playPromise reject with error"),this.ws.connectionPromise&&this.ws.connectionPromise.then(function(){return t.ws.pause()}),this.liveError||(this.opts.onError&&this.opts.onError({error:"playPromise reject - stream unavaible"}),this.liveError=!0),this.rejectThenMediaSourceOpen&&(this.rejectThenMediaSourceOpen(),this.resolveThenMediaSourceOpen=void 0,this.rejectThenMediaSourceOpen=void 0),this.playPromise=Promise.reject("stream unavaible"),this.mediaSource.endOfStream();break;case"tracks_switched":break;default:this.opts.onError&&this.opts.onError({error:"unhandled_event",event:i}),u.logger.warn("unknown type of event",i)}return}if(o&&o.type===c.MSE_INIT_SEGMENT)return this.procInitSegment(r)}catch(t){a.showDispatchError.bind(this)(e,t);try{if(this.mediaInfo&&this.mediaInfo.activeStreams){var s=this.mediaInfo.activeStreams;this.setTracks([s.video?s.video:"",s.audio?s.audio:""])}}catch(t){this.ws.pause()}}}},v.prototype.procInitSegment=function(e){var t=JSON.parse(e);if(t.type!==c.MSE_INIT_SEGMENT)return u.logger.warn("type is not "+c.MSE_INIT_SEGMENT);this.waitForInitFrame&&(this.waitForInitFrame=!1),this.sb.isBuffered()&&this.sb.seek(),this.sb.setTracksByType(t);var r=i({},t.metadata,{tracks:t.metadata.streams?t.metadata.streams:t.metadata.tracks,streams:t.metadata.streams?t.metadata.streams:t.metadata.tracks}),n=t.metadata.streams;t.metadata.tracks&&(n=t.metadata.tracks);var o={};this.sb.videoTrackId&&n[this.sb.videoTrackId-1]&&n[this.sb.videoTrackId-1].track_id&&(o.video=n[this.sb.videoTrackId-1].track_id),this.sb.audioTrackId?n[this.sb.audioTrackId-1]&&n[this.sb.audioTrackId-1].track_id&&(o.audio=n[this.sb.audioTrackId-1].track_id):this.mediaSource&&this.sb.sourceBuffer&&this.sb.sourceBuffer.audio&&this.mediaSource.removeSourceBuffer(this.sb.sourceBuffer.audio),this.doMediaInfo(i({},r,{activeStreams:o,version:v.version})),u.logger.log("%cprocInitSegment:","background: lightpink;",t),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(t)),this.liveError||this.sb.createTracks(t.tracks)},v.prototype.doMediaInfo=function(e){if(u.logger.log("%cmediaInfo:","background: orange;",e),this.onMediaInfo){this.mediaInfo=e;try{this.onMediaInfo(e)}catch(e){}}},v.prototype.getVideoTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===p})}},v.prototype.getAudioTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===y})}},v.prototype.immediateLevelSwitchEnd=function(){var e=this,t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=t.play(),this.playPromise.then(function(){e._pause=!1,e.playing=!0})))},v.prototype.onStartStalling=function(){this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,u.logger.log("onStartStalling")},v.prototype.onEndStalling=function(){this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,u.logger.log("onEndStalling")},v.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},v.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},v.prototype.onTimer=function(){if(this._eos)return u.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){}},v.prototype.onMediaSourceEnded=function(){u.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){}},v.prototype.onMediaSourceClose=function(){u.logger.log("media source closed")},v.prototype.onConnectionRetry=function(){var e=this;this.retryConnectionTimer||this._stop?this.retry>=this.opts.connectionRetries&&clearInterval(this.retryConnectionTimer):this.retry<this.opts.connectionRetries&&(this.retryConnectionTimer=setInterval(function(){return e.retryConnection()},5e3))},v.prototype.debounce=function(n,o,i){var s;return function(){var e=this,t=arguments,r=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||n.apply(e,t)},o),r&&n.apply(e,t)}},v);function v(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),r.debug&&((0,u.enableLogs)(!0),window.humanTime=a.humanTime),u.logger.info("[mse-player]:",v.version),this.opts=r||{},this.media=e,this.url=t,this.opts.progressUpdateTime=this.opts.progressUpdateTime||100,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop?this.opts.errorsBeforeStop:1,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");if(this.opts.connectionRetries=this.opts.connectionRetries||0,"number"!=typeof this.opts.connectionRetries||isNaN(this.opts.connectionRetries))throw new Error("invalid connectionRetries param, should be number");if(this.opts.wsReconnect=!!this.opts.wsReconnect&&this.opts.wsReconnect,"boolean"!=typeof this.opts.wsReconnect)throw new Error("invalid wsReconnect param, should be boolean");if(this.retry=0,this.retryConnectionTimer,this.opts.retryMuted=!!this.opts.retryMuted&&this.opts.retryMuted,"boolean"!=typeof this.opts.retryMuted)throw new Error("invalid retryMuted param, should be boolean");this.onProgress=r&&r.onProgress,r&&r.onDisconnect?this.onDisconnect=r&&r.onDisconnect:this.onDisconnect=function(e){u.logger.log("[websocket status]:",e)},this.onMediaInfo=r&&r.onMediaInfo,this.onError=r&&r.onError,this.onAutoplay=r&&r.onAutoplay,this.onMuted=r&&r.onMuted,this.init(),e instanceof HTMLMediaElement&&(e.WebKitPlaysInline=!0),this.ws=new o.default({message:this.dispatchMessage.bind(this),closed:this.onDisconnect.bind(this),error:this.onError,wsReconnect:this.opts.wsReconnect}),this.sb=new s.default({media:e})}t.default=m,e.exports=t.default},function(e,t,r){r(18),e.exports=r(3).Array.find},function(e,t,r){var n=r(19),o=r(29)(5),i="find",s=!0;i in[]&&Array(1)[i](function(){s=!1}),n(n.P+n.F*s,"Array",{find:function(e,t){return o(this,e,1<arguments.length?t:void 0)}}),r(39)(i)},function(e,t,r){var y=r(0),m=r(3),v=r(4),g=r(26),b=r(9),E="prototype",_=function(e,t,r){var n,o,i,s,a=e&_.F,u=e&_.G,c=e&_.S,h=e&_.P,f=e&_.B,l=u?y:c?y[t]||(y[t]={}):(y[t]||{})[E],d=u?m:m[t]||(m[t]={}),p=d[E]||(d[E]={});for(n in u&&(r=t),r)i=((o=!a&&l&&void 0!==l[n])?l:r)[n],s=f&&o?b(i,y):h&&"function"==typeof i?b(Function.call,i):i,l&&g(l,n,i,e&_.U),d[n]!=i&&v(d,n,s),h&&p[n]!=i&&(p[n]=i)};y.core=m,_.F=1,_.G=2,_.S=4,_.P=8,_.B=16,_.W=32,_.U=64,_.R=128,e.exports=_},function(e,t,r){var n=r(21),o=r(22),i=r(24),s=Object.defineProperty;t.f=r(5)?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),o)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(1);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=!r(5)&&!r(7)(function(){return 7!=Object.defineProperty(r(23)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(1),o=r(0).document,i=n(o)&&n(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,r){var o=r(1);e.exports=function(e,t){if(!o(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!o(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!o(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!o(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var i=r(0),s=r(4),a=r(27),u=r(8)("src"),n="toString",o=Function[n],c=(""+o).split(n);r(3).inspectSource=function(e){return o.call(e)},(e.exports=function(e,t,r,n){var o="function"==typeof r;o&&(a(r,"name")||s(r,"name",t)),e[t]!==r&&(o&&(a(r,u)||s(r,u,e[t]?""+e[t]:c.join(String(t)))),e===i?e[t]=r:n?e[t]?e[t]=r:s(e,t,r):(delete e[t],s(e,t,r)))})(Function.prototype,n,function(){return"function"==typeof this&&this[u]||o.call(this)})},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var b=r(9),E=r(30),_=r(31),S=r(33),n=r(35);e.exports=function(f,e){var l=1==f,d=2==f,p=3==f,y=4==f,m=6==f,v=5==f||m,g=e||n;return function(e,t,r){for(var n,o,i=_(e),s=E(i),a=b(t,r,3),u=S(s.length),c=0,h=l?g(e,u):d?g(e,0):void 0;c<u;c++)if((v||c in s)&&(o=a(n=s[c],c,i),f))if(l)h[c]=o;else if(o)switch(f){case 3:return!0;case 5:return n;case 6:return c;case 2:h.push(n)}else if(y)return!1;return m?-1:p||y?y:h}}},function(e,t,r){var n=r(10);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(32);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(34),o=Math.min;e.exports=function(e){return 0<e?o(n(e),9007199254740991):0}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?n:r)(e)}},function(e,t,r){var n=r(36);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(1),o=r(37),i=r(11)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(10);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(0),o="__core-js_shared__",i=n[o]||(n[o]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,r){var n=r(11)("unscopables"),o=Array.prototype;null==o[n]&&r(4)(o,n,{}),e.exports=function(e){o[n][e]=!0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=l;var u=n(r(41)),c=n(r(6)),h=r(2);function n(e){return e&&e.__esModule?e:{default:e}}var f="live",o=(i.prototype.init=function(){this.opened=!1,this.connectionPromise=void 0,clearTimeout(this.reconnect),this.reconnect=void 0},i.prototype.start=function(n,o,e,t){var i=this,s=2<arguments.length&&void 0!==e?e:"",a=3<arguments.length&&void 0!==t?t:"";return this.socketURL={url:n,time:o,videoTrack:s,audioTack:a},this.connectionPromise=new Promise(function(e,t){var r=l(n,o,s,a);i.websocket=new WebSocket(r),i.websocket.binaryType="arraybuffer",i.websocket.addEventListener(c.default.WS_OPEN,i.onwso),i.websocket.addEventListener(c.default.WS_MESSAGE,i.onwsm),i.websocket.addEventListener(c.default.WS_ERROR,i.onwse),i.websocket.addEventListener(c.default.WS_CLOSE,i.onwsc),i._openingResolve=e,i._openingReject=t}),this.connectionPromise},i.prototype.open=function(){this.opened=!0,this.paused=!0,this._openingResolve(),this.resume(),this.websocket.removeEventListener(c.default.WS_OPEN,this.onwso)},i.prototype.send=function(e){this.websocket.send(e)},i.prototype.resume=function(){var e=this;if(clearTimeout(this.reconnect),h.logger.log("ws: send resume"),0===this.websocket.readyState)return setTimeout(function(){return e.resume()},500);this.websocket.send("resume"),this.paused=!1},i.prototype.pause=function(){h.logger.log("ws: send pause"),1===this.websocket.readyState&&(this.websocket.send("pause"),this.paused=!0)},i.prototype.seek=function(e){var t=e===f?"":"play_from=";h.logger.log(t+e),this.websocket.send(t+e)},i.prototype.setTracks=function(e,t){var r=1<arguments.length&&void 0!==t?t:null;this.websocket.send("set_tracks="+e+r)},i.prototype.handleReceiveMessage=function(e){this.opts.message(e)},i.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},i.prototype.onWSClose=function(e){var t=this;if(h.logger.log("WebSocket lost connection with code ",e.code+" and reason: "+e.reason),this.opts.wsReconnect)if(e.wasClean&&1e3!==e.code&&1006!==e.code)h.logger.log("Clean websocket stop"),this.destroy();else{var r=this.socketURL,n=r.url,o=r.time,i=r.videoTrack,s=r.audioTack;this.reconnect=setTimeout(function(){t.start(n,o,i,s).then(function(){clearTimeout(t.reconnect)}).catch(function(){t.destroy()})},5e3)}this.opts.closed&&this.opts.closed(e)},i.prototype.destroy=function(){this.websocket&&(this.pause(),this.websocket.removeEventListener(c.default.WS_MESSAGE,this.onwsm),this.websocket.close(),this.websocket.onclose=void 0,clearTimeout(this.reconnect),this.reconnect=void 0,this.init())},i);function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.opts=e,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this),this.onwsc=this.onWSClose.bind(this)}function l(e,t,r,n){var o=t;if(!o&&!r&&!n)return e;var i=(0,u.default)({url:e}),s="";i.query&&(s=i.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),h.logger.log(s));var a=!!r||!!n;return i.protocol+"//"+i.host+i.pathname+"?"+(a?"tracks="+r+n:"")+(a&&o&&o!==f?"&":"")+(t===f?"":"from="+Math.floor(o))+((a||o&&o!==f)&&s?"&":"")+s}t.default=o},function(e,t,r){var n=r(42),s=n.parse,a=n.Url;function o(e){var t=e.url;if(void 0!==t){var r=e._parsedUrl;return u(t,r)?r:((r=i(t))._raw=t,e._parsedUrl=r)}}function i(e){if("string"!=typeof e||47!==e.charCodeAt(0))return s(e);for(var t=e,r=null,n=null,o=1;o<e.length;o++)switch(e.charCodeAt(o)){case 63:null===n&&(t=e.substring(0,o),r=e.substring(o+1),n=e.substring(o));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return s(e)}var i=void 0!==a?new a:{};return i.path=e,i.href=e,i.pathname=t,i.query=r,i.search=n,i}function u(e,t){return"object"==typeof t&&null!==t&&(void 0===a||t instanceof a)&&t._raw===e}e.exports=o,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return o(e);var r=e._parsedOriginalUrl;return u(t,r)?r:((r=i(t))._raw=t,e._parsedOriginalUrl=r)}},function(e,t,r){var U=r(43),R=r(46);function k(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=i,t.resolve=function(e,t){return i(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},t.format=function(e){return R.isString(e)&&(e=i(e)),e instanceof k?e.format():k.prototype.format.call(e)},t.Url=k;var x=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,C=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,o=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),D=["'"].concat(o),L=["%","/","?",";","#"].concat(D),N=["/","?","#"],F=/^[+a-z0-9A-Z_-]{0,63}$/,q=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,V={javascript:!0,"javascript:":!0},W={javascript:!0,"javascript:":!0},H={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},G=r(47);function i(e,t,r){if(e&&R.isObject(e)&&e instanceof k)return e;var n=new k;return n.parse(e,t,r),n}k.prototype.parse=function(e,t,r){if(!R.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",i=e.split(o);i[0]=i[0].replace(/\\/g,"/");var s=e=i.join(o);if(s=s.trim(),!r&&1===e.split("#").length){var a=C.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?G.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var u=x.exec(s);if(u){var c=(u=u[0]).toLowerCase();this.protocol=c,s=s.substr(u.length)}if(r||u||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var h="//"===s.substr(0,2);!h||u&&W[u]||(s=s.substr(2),this.slashes=!0)}if(!W[u]&&(h||u&&!H[u])){for(var f,l,d=-1,p=0;p<N.length;p++)-1!==(y=s.indexOf(N[p]))&&(-1===d||y<d)&&(d=y);for(-1!==(l=-1===d?s.lastIndexOf("@"):s.lastIndexOf("@",d))&&(f=s.slice(0,l),s=s.slice(l+1),this.auth=decodeURIComponent(f)),d=-1,p=0;p<L.length;p++){var y;-1!==(y=s.indexOf(L[p]))&&(-1===d||y<d)&&(d=y)}-1===d&&(d=s.length),this.host=s.slice(0,d),s=s.slice(d),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var v=this.hostname.split(/\./),g=(p=0,v.length);p<g;p++){var b=v[p];if(b&&!b.match(F)){for(var E="",_=0,S=b.length;_<S;_++)127<b.charCodeAt(_)?E+="x":E+=b[_];if(!E.match(F)){var w=v.slice(0,p),T=v.slice(p+1),O=b.match(q);O&&(w.push(O[1]),T.unshift(O[2])),T.length&&(s="/"+T.join(".")+s),this.hostname=w.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=U.toASCII(this.hostname));var M=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+M,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!V[c])for(p=0,g=D.length;p<g;p++){var A=D[p];if(-1!==s.indexOf(A)){var P=encodeURIComponent(A);P===A&&(P=escape(A)),s=s.split(A).join(P)}}var I=s.indexOf("#");-1!==I&&(this.hash=s.substr(I),s=s.slice(0,I));var j=s.indexOf("?");if(-1!==j?(this.search=s.substr(j),this.query=s.substr(j+1),t&&(this.query=G.parse(this.query)),s=s.slice(0,j)):t&&(this.search="",this.query={}),s&&(this.pathname=s),H[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){M=this.pathname||"";var B=this.search||"";this.path=M+B}return this.href=this.format(),this},k.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&R.isObject(this.query)&&Object.keys(this.query).length&&(i=G.stringify(this.query));var s=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||H[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o=o||"",n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+n},k.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},k.prototype.resolveObject=function(e){if(R.isString(e)){var t=new k;t.parse(e,!1,!0),e=t}for(var r=new k,n=Object.keys(this),o=0;o<n.length;o++){var i=n[o];r[i]=this[i]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),a=0;a<s.length;a++){var u=s[a];"protocol"!==u&&(r[u]=e[u])}return H[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!H[e.protocol]){for(var c=Object.keys(e),h=0;h<c.length;h++){var f=c[h];r[f]=e[f]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||W[e.protocol])r.pathname=e.pathname;else{for(var l=(e.pathname||"").split("/");l.length&&!(e.host=l.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),r.pathname=l.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var d=r.pathname||"",p=r.search||"";r.path=d+p}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var y=r.pathname&&"/"===r.pathname.charAt(0),m=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=m||y||r.host&&e.pathname,g=v,b=r.pathname&&r.pathname.split("/")||[],E=(l=e.pathname&&e.pathname.split("/")||[],r.protocol&&!H[r.protocol]);if(E&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===l[0]?l[0]=e.host:l.unshift(e.host)),e.host=null),v=v&&(""===l[0]||""===b[0])),m)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,b=l;else if(l.length)(b=b||[]).pop(),b=b.concat(l),r.search=e.search,r.query=e.query;else if(!R.isNullOrUndefined(e.search))return E&&(r.hostname=r.host=b.shift(),(O=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=O.shift(),r.host=r.hostname=O.shift())),r.search=e.search,r.query=e.query,R.isNull(r.pathname)&&R.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var _=b.slice(-1)[0],S=(r.host||e.host||1<b.length)&&("."===_||".."===_)||""===_,w=0,T=b.length;0<=T;T--)"."===(_=b[T])?b.splice(T,1):".."===_?(b.splice(T,1),w++):w&&(b.splice(T,1),w--);if(!v&&!g)for(;w--;)b.unshift("..");!v||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),S&&"/"!==b.join("/").substr(-1)&&b.push("");var O,M=""===b[0]||b[0]&&"/"===b[0].charAt(0);return E&&(r.hostname=r.host=!M&&b.length?b.shift():"",(O=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=O.shift(),r.host=r.hostname=O.shift())),(v=v||r.host&&b.length)&&!M&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),R.isNull(r.pathname)&&R.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},k.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,m,k){(function(d,p){var y;!function(){m&&m.nodeType,d&&d.nodeType;var e="object"==typeof p&&p;e.global!==e&&e.window!==e&&e.self;var t,v=2147483647,g=36,b=26,o=38,i=700,r=/^xn--/,n=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,a={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},u=g-1,E=Math.floor,_=String.fromCharCode;function S(e){throw new RangeError(a[e])}function c(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function h(e,t){var r=e.split("@"),n="";return 1<r.length&&(n=r[0]+"@",e=r[1]),n+c((e=e.replace(s,".")).split("."),t).join(".")}function w(e){for(var t,r,n=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function T(e){return c(e,function(e){var t="";return 65535<e&&(t+=_((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=_(e)}).join("")}function O(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function M(e,t,r){var n=0;for(e=r?E(e/i):e>>1,e+=E(e/t);u*b>>1<e;n+=g)e=E(e/u);return E(n+(u+1)*e/(e+o))}function f(e){var t,r,n,o,i,s,a,u,c,h,f,l=[],d=e.length,p=0,y=128,m=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)128<=e.charCodeAt(n)&&S("not-basic"),l.push(e.charCodeAt(n));for(o=0<r?r+1:0;o<d;){for(i=p,s=1,a=g;d<=o&&S("invalid-input"),f=e.charCodeAt(o++),(g<=(u=f-48<10?f-22:f-65<26?f-65:f-97<26?f-97:g)||u>E((v-p)/s))&&S("overflow"),p+=u*s,!(u<(c=a<=m?1:m+b<=a?b:a-m));a+=g)s>E(v/(h=g-c))&&S("overflow"),s*=h;m=M(p-i,t=l.length+1,0==i),E(p/t)>v-y&&S("overflow"),y+=E(p/t),p%=t,l.splice(p++,0,y)}return T(l)}function l(e){var t,r,n,o,i,s,a,u,c,h,f,l,d,p,y,m=[];for(l=(e=w(e)).length,t=128,i=72,s=r=0;s<l;++s)(f=e[s])<128&&m.push(_(f));for(n=o=m.length,o&&m.push("-");n<l;){for(a=v,s=0;s<l;++s)t<=(f=e[s])&&f<a&&(a=f);for(a-t>E((v-r)/(d=n+1))&&S("overflow"),r+=(a-t)*d,t=a,s=0;s<l;++s)if((f=e[s])<t&&++r>v&&S("overflow"),f==t){for(u=r,c=g;!(u<(h=c<=i?1:i+b<=c?b:c-i));c+=g)y=u-h,p=g-h,m.push(_(O(h+y%p,0))),u=E(y/p);m.push(_(O(u,0))),i=M(r,d,n==o),r=0,++n}++r,++t}return m.join("")}t={version:"1.4.1",ucs2:{decode:w,encode:T},decode:f,encode:l,toASCII:function(e){return h(e,function(e){return n.test(e)?"xn--"+l(e):e})},toUnicode:function(e){return h(e,function(e){return r.test(e)?f(e.slice(4).toLowerCase()):e})}},void 0===(y=function(){return t}.call(m,k,m,d))||(d.exports=y)}()}).call(this,k(44)(e),k(45))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){t.decode=t.parse=r(48),t.encode=t.stringify=r(49)},function(e,t,r){e.exports=function(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(t);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a,u,c=e.length;0<s&&s<c&&(c=s);for(var h=0;h<c;++h){var f,l,d,p,y=e[h].replace(i,"%20"),m=y.indexOf(r);l=0<=m?(f=y.substr(0,m),y.substr(m+1)):(f=y,""),d=decodeURIComponent(f),p=decodeURIComponent(l),a=o,u=d,Object.prototype.hasOwnProperty.call(a,u)?v(o[d])?o[d].push(p):o[d]=[o[d],p]:o[d]=p}return o};var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(r,n,o,e){return n=n||"&",o=o||"=",null===r&&(r=void 0),"object"==typeof r?a(u(r),function(e){var t=encodeURIComponent(i(e))+o;return s(r[e])?a(r[e],function(e){return t+encodeURIComponent(i(e))}).join(n):t+encodeURIComponent(i(r[e]))}).join(n):e?encodeURIComponent(i(e))+o+encodeURIComponent(i(r)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var u=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(12),f=r(2),s=r(13),a=r(6),n=(i.prototype.init=function(e){var t=0<arguments.length&&void 0!==e?e:{};this.flushRange=[],this.appended=0,this.mediaSource=t.mediaSource,this.segmentsVideo=[],this.segmentsAudio=[],this.sourceBuffer={}},i.prototype.setMediaSource=function(e){this.mediaSource=e},i.prototype.createSourceBuffers=function(e){var o=this,i=this.sourceBuffer;e.tracks.forEach(function(e){var t=e.content===s.VIDEO,r=t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"';i[e.content]=o.mediaSource.addSourceBuffer(r);var n=i[e.content];t?n.addEventListener(a.BUFFER_UPDATE_END,o.onSBUpdateEnd):n.addEventListener(a.BUFFER_UPDATE_END,o.onAudioSBUpdateEnd)})},i.prototype.onSBUpdateEnd=function(){if(this._needsFlush&&(f.logger.log("flushing buffer"),this.doFlush()),this._needsEos&&this.checkEos(),!this._needsFlush&&this.segmentsVideo.length){var e=this.sourceBuffer.video;if(e){if(e.updating)return;var t=this.segmentsVideo[0];e.appendBuffer(t.data),this.segmentsVideo.shift(),this.appended++}}},i.prototype.onAudioSBUpdateEnd=function(){if(this._needsFlush&&(f.logger.log("flushing buffer"),this.doFlush()),this._needsEos&&this.checkEos(),!this._needsFlush&&this.segmentsAudio.length){var e=this.sourceBuffer.audio;if(e){if(e.updating)return;var t=this.segmentsAudio[0];e.appendBuffer(t.data),this.segmentsAudio.shift(),this.appended++}}},i.prototype.createTracks=function(e){var n=this;e.forEach(function(e){var t=(0,o.base64ToArrayBuffer)(e.payload),r={type:n.getTypeBytrackId(e.id),isInit:!0,data:t};n.maybeAppend(r)})},i.prototype.maybeAppend=function(e){if(!this._needsFlush){if(!this.media||this.media.error)return"audio"===e.type?this.segmentsAudio=[]:this.segmentsVideo=[],void f.logger.error("trying to append although a media error occured, flush segment and abort");var t=this.sourceBuffer[e.type];if(t){if(t.updating)return;t.appendBuffer(e.data),"audio"===e.type?this.segmentsAudio.shift():this.segmentsVideo.shift(),this.appended++}}},i.prototype.setTracksByType=function(e){var t=this,r=e.tracks?"tracks":"streams";1===e[r].length&&(this.audioTrackId=null),e[r].forEach(function(e){t[e.content===s.VIDEO?"videoTrackId":"audioTrackId"]=e.id})},i.prototype.getTypeBytrackId=function(e){return this.audioTrackId===e?s.AUDIO:s.VIDEO},i.prototype.procArrayBuffer=function(e){var t=this.rawDataToSegmnet(e);"audio"===t.type?this.segmentsAudio.push(t):this.segmentsVideo.push(t),this.doArrayBuffer(t),this.sourceBuffer&&(this.sourceBuffer.video&&!this.sourceBuffer.video.updating&&this.onSBUpdateEnd(),this.sourceBuffer.audio&&!this.sourceBuffer.audio.updating&&this.onAudioSBUpdateEnd())},i.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode="sequence";this.segmentsVideo=[],this.segmentsAudio=[]},i.prototype.isBuffered=function(){var e=0,t=this.sourceBuffer;for(var r in t)e+=t[r].buffered.length;return 0<e},i.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var n in r)t+=r[n].buffered.length}catch(e){}this.appended=t,this._setTracksFlag=!1}},i.prototype.flushBuffer=function(e,t,r){var n=void 0,o=void 0,i=void 0,s=void 0,a=void 0,u=void 0,c=this.sourceBuffer;if(Object.keys(c).length){if(f.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var h in c)if(!r||h===r){if((n=c[h]).ended=!1,n.updating)return f.logger.warn("cannot flush, sb updating in progress"),!1;try{for(o=0;o<n.buffered.length;o++)if(i=n.buffered.start(o),s=n.buffered.end(o),u=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,t):(a=Math.max(i,e),Math.min(s,t)),.5<Math.min(u,s)-a)return this.flushBufferCounter++,f.logger.log("flush "+h+" ["+a+","+u+"], of ["+i+","+s+"], pos:"+this.media.currentTime),n.remove(a,u),!1}catch(e){f.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else f.logger.warn("abort flushing too many retries");f.logger.log("buffer flushed")}return!0},i.prototype.rawDataToSegmnet=function(e){var t=new Uint8Array(e),r=(0,o.getTrackId)(t);return{type:this.getTypeBytrackId(r),data:t}},i.prototype.onBufferEos=function(e){var t=0<arguments.length&&void 0!==e?e:{},r=this.sourceBuffer,n=t.type;for(var o in r)n&&o!==n||r[o].ended||(r[o].ended=!0,f.logger.log(o+" sourceBuffer now EOS"));this.checkEos()},i.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var n=e[r];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}f.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){f.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.prototype.destroy=function(){this.init()},i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),f.logger.log("create BuffersController"),this.media=e.media,this.init(e),this.doArrayBuffer=o.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this),this.onAudioSBUpdateEnd=this.onAudioSBUpdateEnd.bind(this)}t.default=n,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default}],o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=14))}(I={exports:{}},I.exports),I.exports),U=(j=B)&&j.__esModule&&Object.prototype.hasOwnProperty.call(j,"default")?j.default:j,R=(B.FlussonicMsePlayer,!0),x=function(){function i(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=u(this,(e=a(i)).call.apply(e,[this].concat(n)))).options.playback||(t.options.playback=t.options),t._startTimeUpdateTimer(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(i,s.HTML5Video),e(i,[{key:"name",get:function(){return"mseld"}},{key:"levels",get:function(){return this._levels||[]}},{key:"currentLevel",get:function(){return null===this._currentLevel||void 0===this._currentLevel?-1:this._currentLevel},set:function(e){this._currentLevel=e,this.trigger(s.Events.PLAYBACK_LEVEL_SWITCH_START),this.setTracks(e)}}],[{key:"MSELD",get:function(){return i}}]),e(i,[{key:"_startTimeUpdateTimer",value:function(){var e=this;this._timeUpdateTimer=setInterval(function(){e._onTimeUpdate()},100)}},{key:"_onTimeUpdate",value:function(){var e={current:this.getCurrentTime(),total:this.getDuration()};this._lastTimeUpdate&&e.current===this._lastTimeUpdate.current||(this._lastTimeUpdate=e,this.trigger(s.Events.PLAYBACK_TIMEUPDATE,e,this.name))}},{key:"_updateSettings",value:function(){this.settings.left=["playstop"],this.trigger(s.Events.PLAYBACK_SETTINGSUPDATE)}},{key:"_onDurationChange",value:function(){var e=this.getDuration();this._lastDuration===e||(this._lastDuration=e,o(a(i.prototype),"_onDurationChange",this).call(this))}},{key:"_stopTimeUpdateTimer",value:function(){clearInterval(this._timeUpdateTimer)}},{key:"getPlaybackType",value:function(){return s.Playback.LIVE}},{key:"destroy",value:function(){this.MSE&&(this.MSE.stop(),this.MSE=void 0),this._stopTimeUpdateTimer(),o(a(i.prototype),"destroy",this).call(this)}},{key:"resolveRedirect",value:function(t){return fetch(t,{method:"OPTIONS"}).catch(function(){return t}).then(function(e){return e.headers&&e.headers.get("location")?e.headers.get("location"):t})}},{key:"getStartTimeOffset",value:function(){return this.getCurrentTime()}},{key:"play",value:function(){var o=this;if(!this._waitStatus&&!this.MSE){var e=this.options.src;this.resolveRedirect(e).then(function(e){var t=U.replaceHttpByWS(e);o.options.autoplay&&!o.options.mute&&(o.el.autoplay=!0,o.el.muted=!1,o.el.volume=1);var r=function(e){o.autoplayFunction=e,0==R&&e(),R=!1};r=r.bind(o),o.MSE=new U(o.el,t,{debug:o.options.debug,connectionRetries:0,onError:function(){},onAutoplay:r,onMediaInfo:function(e){var t=o.options.onMediaInfo;if(t&&"function"==typeof t){var r=e.streams||e.tracks;r&&0<r.length&&(o._levels=r.filter(function(e){return e.content&&"audio"===e.content&&(o.audio=e),!(!e.content||"video"!==e.content)}).map(function(e,t){return{id:t,level:e.size,label:"".concat(e.bitrate,"Kbps"),bitrate:e.bitrate,track_id:e.track_id}}),o.trigger(s.Events.PLAYBACK_LEVELS_AVAILABLE,o._levels)),t(e)}}});var n=o.MSE.play();n&&n.then(function(){o.trigger(s.Events.PLAYBACK_PLAY_INTENT),o._stopped=!1})})}}},{key:"setTracks",value:function(e){var t=-1===e?0:e;if(this.MSE){var r;this.audio&&this.audio.track_id&&(r=this.audio.track_id);var n=[];this._levels[t]&&n.push(this._levels[t].track_id),void 0!==r&&n.push(r),0<n.length&&this.MSE.setTracks(n)}this.trigger(s.Events.PLAYBACK_LEVEL_SWITCH_END)}},{key:"setWaitStatus",value:function(e){this._waitStatus=e}},{key:"stop",value:function(){var e=this;this.MSE&&this.MSE.stop().then(function(){o(a(i.prototype),"stop",e).call(e),e.MSE=void 0})}}]),i}();return x.isSupported=function(){return U.isSupported()},x.canPlay=function(e,t){return(-1!=e.indexOf("mse_ld")||"application/x-flussonic-mse"==t)&&x.isSupported()},x.waitingAutoplay=function(){if(U.autoplayFunction)return U.autoplayFunction},x});
